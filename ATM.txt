#include"stdio.h"
#include"stdlib.h"
#include"string.h"
struct zh
{
	char zh[100];
	char mm[18];
	double m;
};
typedef struct zh zh;
zh a[100];
int i=0,n=-1;
FILE *p;
int dl()
{
	char u[100]; 
	system("cls");
	printf("输入账户:");
	scanf("%s",u);
	for(n=0;n<i;n++)
	{
		if(!strcmp(u,a[n].zh))
		{
			printf("输入密码:");
			while(1)
			{	
				scanf("%s",u);
				if(!strcmp(u,a[n].mm))
					return n; 
				else
					printf("密码错误从新输入！");
			}
		}
		else
			n=-1;
		break;
	}
}
void tc()
{
	n=0;
	fclose(p);
	p=fopen("zh.txt","w");
	if(p)
	{
		while(n<i)
		{
			fprintf(p,"%s %s %.3f\n",a[n].zh,a[n].mm,a[n].m);
			n++;
		}
	}
	fclose(p);
	exit(0); 
}
int qk()
{
	system("cls");
	double m;
	while(1)
	{
		printf("请输入取款金额:");
		scanf("%lf",&m); 
		if(m<0||a[n].m<m)
		{
			printf("余额不足或输入错误!	按<1>继续");
			scanf("%ld",&m); 
		}
		else
		{
			a[n].m-=m;
			printf("是否继续 是<1>	否<0>");
			scanf("%ld",&m);
			if(!m)
				break;
		}
	}
}
void ck()
{
	double m;
	while(1)
	{
		system("cls");
		printf("输入存款金额:");
		scanf("%lf",&m);
		a[n].m+=m;
		printf("是否继续！<1>是 <0>否");
		scanf("%lf",&m);
		if(!m)
			break;
	}
}
void xg()
{
	printf("输入要修改的密码：");
	scanf("%s",a[n].mm);
}
int zz()
{
	char b[100];
	int k=0,l=0;
	double m;
	while(l<2)
	{	
		system("cls");
		printf("输入要转账的账户:");
		scanf("%s",b);
		k=0;
		while(1)
		{
			if(k==i)
			{
				printf("账号输入有误！");
				scanf("%d",&k);
				break;
			}
			if(!strcmp(b,a[k].zh))
				break;
			k++;
		}
		if(!strcmp(b,a[k].zh))
			break;
		l++;
	}
	if(l>=2)
		return 0;
	T:while(1)
	{
		system("cls");
		printf("转账金额:");
		scanf("%lf",&m);
		if(a[n].m<m)
		{
			printf("余额不足！按<1>继续");
			scanf("%lf",&m); 
		}
		else
		{
			a[n].m-=m,a[k].m+=m;
			printf("是否继续 按<1>继续 <0>返回");
			scanf("%lf",&m);
			if(!m)
				break;
		}
	}
}
main()
{
	char zh[100],c;
	int v; 
	p=fopen("zh.txt","r");
	if(p)
	{
		while(!feof(p))
		{
			fscanf(p,"%s%s%lf",a[i].zh,a[i].mm,&a[i].m);
			i++;
		}
	}
	while(1)
	{
		system("cls");
		printf("1:登录\t\t2:退出\n3:取款\t\t4:存款\n5:转账\t\t6:修改密码");
		scanf("%c",&c);
		switch(c)
		{
			case '1':dl();break;
			case '2':
					if(n!=-1)
						tc();
					else
					{
						printf("请先登录！（按<1>继续）");
						scanf("%d",&v);
					}
					break;
			case '3':
					if(n!=-1)
						qk();
					else
					{		
						printf("请先登录！（按<1>继续）");
						scanf("%d",&v); 
					}
					break;
			case '4':
					if(n!=-1)
						ck();
					else
					{	
						printf("请先登录！（按<1>继续）");
						scanf("%d",&v);
					}
					break;
			case '6':
					if(n!=-1)
						xg();
					else
					{
						printf("请先登录！（按<1>继续）");
						scanf("%d",&v);;
					}
					break;
			case '5':
					if(n!=-1)
						zz();
					else
					{
						printf("请先登录！（按<1>继续）");
						scanf("%d",&v);;
					}
					break;
		}
	}
}